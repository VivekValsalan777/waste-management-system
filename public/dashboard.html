<!DOCTYPE html>
<html>
<head><title>Admin Dashboard</title></head>
<body>

<h2>Admin Dashboard</h2>
<button onclick="load()">Load Reports</button>

<table border="1" cellpadding="6">
  <thead>
    <tr>
      <th>Image</th>
      <th>ID</th>
      <th>Status</th>
      <th>Update</th>
      <th>Location</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody id="table"></tbody>
</table>

<script>
function load() {
  fetch("/admin/reports")
    .then(r => r.json())
    .then(data => {
      table.innerHTML = "";
      data.forEach(r => {
        const map =
          `https://www.google.com/maps?q=${r.location.latitude},${r.location.longitude}`;
        table.innerHTML += `
          <tr>
            <td><img src="/uploads/${r.image}" width="100"></td>
            <td>${r.reportId}</td>
            <td>${r.status}</td>
            <td>
              <select id="s-${r.reportId}">
                <option ${r.status=="Pending"?"selected":""}>Pending</option>
                <option ${r.status=="In Progress"?"selected":""}>In Progress</option>
                <option ${r.status=="Completed"?"selected":""}>Completed</option>
              </select>
              <button onclick="update('${r.reportId}')">Save</button>
            </td>
            <td><a href="${map}" target="_blank">View Map</a></td>
            <td>${new Date(r.createdAt).toLocaleString()}</td>
          </tr>`;
      });
    });
}

function update(id) {
  const status = document.getElementById("s-" + id).value;
  fetch("/admin/update-status", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ reportId: id, status })
  })
    .then(() => {
      alert("Status updated");
      load();
    });
}
</script>

</body>
</html>
