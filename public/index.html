<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Report Waste</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Waste Management</h1>
</header>

<div class="container">
  <div class="card">
    <h2>Report Waste</h2>

    <form id="reportForm" enctype="multipart/form-data">
      <input type="file" id="imageInput" name="image" accept="image/*" required>

      <!-- Image preview -->
      <img id="preview" style="display:none; margin-top:10px; max-width:100%; border-radius:6px;">

      <button class="primary" type="submit">Submit Report</button>
    </form>

    <!-- Status messages -->
    <p id="statusMsg" style="margin-top:15px;"></p>

    <!-- Report ID box -->
    <div id="reportBox" style="display:none; margin-top:15px;">
      <strong>Your Report ID:</strong>
      <div style="background:#f1f5f9; padding:10px; border-radius:5px; margin-top:5px;">
        <span id="reportId"></span>
      </div>
      <p style="margin-top:8px; font-size:14px;">
        Save this ID to track your report status.
      </p>
      <a class="link" href="track.html">Track Report</a>
    </div>
  </div>
</div>

<script>
const form = document.getElementById("reportForm");
const statusMsg = document.getElementById("statusMsg");
const reportBox = document.getElementById("reportBox");
const reportIdSpan = document.getElementById("reportId");
const preview = document.getElementById("preview");
const imageInput = document.getElementById("imageInput");

/* IMAGE PREVIEW */
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (file) {
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  }
});

/* FORM SUBMIT */
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  statusMsg.textContent = "Submitting report...";
  reportBox.style.display = "none";

  const formData = new FormData(form);

  try {
    const res = await fetch("/submit-report", {
      method: "POST",
      body: formData
    });

    const data = await res.json();

    if (data.success) {
      statusMsg.textContent = "Report submitted successfully.";
      statusMsg.style.color = "green";

      reportIdSpan.textContent = data.reportId;
      reportBox.style.display = "block";

      form.reset();
      preview.style.display = "none";
    } else {
      throw new Error("Submission failed");
    }
  } catch (err) {
    statusMsg.textContent = "Error submitting report. Please try again.";
    statusMsg.style.color = "red";
  }
});
</script>

</body>
</html>
